/**
 * Touch Interaction Enhancements
 * ================================
 * Optimizations for touch devices
 * Created: 2025-08-22
 */

/* ============================================
   TOUCH TARGET SIZING
   ============================================ */

/* Ensure minimum touch target size (44x44px iOS, 48x48px Android) */
@media (hover: none) and (pointer: coarse) {
  /* All interactive elements */
  button,
  a,
  input[type="button"],
  input[type="submit"],
  input[type="reset"],
  input[type="checkbox"],
  input[type="radio"],
  select,
  .clickable,
  .interactive,
  .touchable {
    min-width: 44px;
    min-height: 44px;
    position: relative;
  }

  /* Extend touch area for small buttons */
  button::before,
  .clickable::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: max(100%, 44px);
    height: max(100%, 44px);
    z-index: -1;
  }

  /* Form inputs */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="url"],
  input[type="search"],
  textarea,
  select {
    min-height: 44px;
    padding: 12px;
    font-size: 16px; /* Prevents zoom on iOS */
  }

  /* Checkbox and radio button touch areas */
  input[type="checkbox"],
  input[type="radio"] {
    width: 20px;
    height: 20px;
    margin: 12px;
  }

  /* Navigation items */
  .nav-item,
  .menu-item,
  .tab-item {
    padding: 12px 16px;
    min-height: 44px;
  }

  /* Floating dock items */
  .dockItem,
  .dock-icon,
  .dock-button {
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Answer options in questions */
  .answerOption,
  .answer-choice,
  .option-button {
    min-height: 48px;
    padding: 14px 20px;
  }

  /* Close buttons */
  .close-button,
  .modal-close,
  .dismiss-button {
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
}

/* ============================================
   TOUCH FEEDBACK
   ============================================ */

/* Remove default tap highlight */
* {
  -webkit-tap-highlight-color: transparent;
}

/* Active states for touch feedback */
@media (hover: none) {
  button:active,
  a:active,
  .clickable:active,
  .touchable:active {
    opacity: 0.7;
    transform: scale(0.98);
    transition: all 0.1s ease;
  }

  /* Specific feedback for different button types */
  .primary-button:active,
  .btn-primary:active {
    transform: scale(0.98);
    box-shadow: none;
  }

  .secondary-button:active,
  .btn-secondary:active {
    background-color: rgba(0, 0, 0, 0.1);
  }

  /* Answer options feedback */
  .answerOption:active {
    background-color: var(--bg-hover);
    border-color: var(--primary-color);
  }

  /* Floating dock feedback */
  .dockItem:active {
    transform: scale(0.9);
    background-color: var(--primary-color);
  }

  /* Remove hover effects on touch devices */
  button:hover,
  a:hover,
  .clickable:hover {
    transform: none;
  }
}

/* ============================================
   GESTURE SUPPORT
   ============================================ */

/* Prevent accidental selection during swipes */
.swipeable,
.carousel,
.slider {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Smooth scrolling for touch */
.scrollable,
.scroll-container {
  -webkit-overflow-scrolling: touch;
  overflow-y: auto;
  overscroll-behavior-y: contain;
}

/* Horizontal scrolling containers */
.horizontal-scroll {
  -webkit-overflow-scrolling: touch;
  overflow-x: auto;
  overflow-y: hidden;
  overscroll-behavior-x: contain;
}

/* Prevent pull-to-refresh on specific elements */
.no-pull-refresh {
  overscroll-behavior-y: contain;
}

/* ============================================
   LONG PRESS PREVENTION
   ============================================ */

/* Disable context menu on long press */
@media (hover: none) {
  img,
  a,
  button {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
}

/* ============================================
   KEYBOARD SUPPORT FOR TOUCH DEVICES
   ============================================ */

/* Ensure virtual keyboard doesn't cover inputs */
@media (hover: none) and (pointer: coarse) {
  input:focus,
  textarea:focus,
  select:focus {
    position: relative;
    z-index: 999;
  }

  /* Adjust modal position when keyboard is open */
  .modal-content:has(input:focus),
  .modal-content:has(textarea:focus) {
    transform: translateY(-25vh);
    transition: transform 0.3s ease;
  }
}

/* ============================================
   TOUCH-FRIENDLY SPACING
   ============================================ */

@media (hover: none) and (pointer: coarse) {
  /* Add spacing between interactive elements */
  .button-group > * + *,
  .action-buttons > * + * {
    margin-left: 12px;
  }

  /* Vertical button stacks */
  .button-stack > * + * {
    margin-top: 12px;
  }

  /* List items with touch targets */
  .interactive-list > li {
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
  }

  /* Card grids with proper spacing */
  .card-grid {
    gap: 16px;
  }

  /* Navigation items spacing */
  .nav-menu > * + * {
    margin-left: 16px;
  }
}

/* ============================================
   DRAG HANDLE INDICATORS
   ============================================ */

/* Visual indicator for draggable elements */
.draggable {
  cursor: grab;
  position: relative;
}

.draggable:active {
  cursor: grabbing;
}

.drag-handle {
  width: 40px;
  height: 4px;
  background: var(--border-color);
  border-radius: 2px;
  margin: 8px auto;
}

/* ============================================
   MOMENTUM SCROLLING
   ============================================ */

/* Enable momentum scrolling on iOS */
.momentum-scroll {
  -webkit-overflow-scrolling: touch;
  overflow-y: scroll;
}

/* Scroll snap for carousels */
.snap-scroll {
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}

.snap-item {
  scroll-snap-align: center;
}

/* ============================================
   RIPPLE EFFECT (Material Design style)
   ============================================ */

@media (hover: none) {
  .ripple {
    position: relative;
    overflow: hidden;
  }

  .ripple::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .ripple:active::after {
    width: 300px;
    height: 300px;
  }
}

/* ============================================
   ACCESSIBILITY FOR TOUCH
   ============================================ */

/* Focus indicators for keyboard navigation on touch devices */
@media (hover: none) {
  :focus-visible {
    outline: 3px solid var(--primary-color);
    outline-offset: 2px;
  }

  button:focus-visible,
  a:focus-visible {
    outline: 3px solid var(--primary-color);
    outline-offset: 2px;
  }
}

/* ============================================
   PREVENT DOUBLE TAP ZOOM
   ============================================ */

/* Disable double-tap zoom on interactive elements */
button,
.button,
.clickable {
  touch-action: manipulation;
}

/* Allow pinch zoom but prevent double-tap */
.zoomable {
  touch-action: pinch-zoom;
}

/* ============================================
   ORIENTATION CHANGE HANDLING
   ============================================ */

/* Smooth transitions on orientation change */
@media (hover: none) {
  * {
    transition: none !important;
  }

  body.orientation-changing * {
    transition: none !important;
  }
}